{% extends "layout.html" %}
{% block content %}

<div class="container py-5">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold mb-1">Fixture</h1>
            <p class="text-muted mb-0">Manage technical specifications and model categories.</p>
        </div>
        <button type="button" class="btn btn-dark rounded-pill px-4" data-bs-toggle="modal"
            data-bs-target="#addFixtureModal">
            <i class="bi bi-plus-lg me-2"></i>New Fixture
        </button>
    </div>

    <!-- Fixtures Grid -->
    <div class="row g-4">
        {% for fixture in fixtures %}
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm border-0 h-100 fixture-card">
                <div class="card-body p-4 d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-3 p-3">
                            <i class="bi bi-lightbulb fs-3"></i>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
                                <li><a class="dropdown-item" href="{{ url_for('edit_fixture', id=fixture.id) }}">
                                        <i class="bi bi-pencil me-2"></i>Edit Details</a>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item text-danger" href="#">
                                        <i class="bi bi-trash me-2"></i>Archive</a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <h5 class="fw-bold mb-1">{{ fixture.name }}</h5>
                    <p class="text-muted small mb-1">{{ fixture.model_name }}</p>

                    <div class="mb-3">
                        <span class="extra-small text-uppercase fw-bold text-primary">
                            <i class="bi bi-factory me-1"></i> Factory: {{ fixture.supplier_name or 'No Supplier Linked'
                            }}
                        </span>
                    </div>

                    <!-- New Inventory Section -->
                    <div class="inventory-section bg-light rounded-3 p-3 mb-4 flex-grow-1">
                        <h6 class="extra-small text-uppercase fw-bold ls-1 text-muted mb-2">Warehouse Availability</h6>

                        {% if dist_map.get(fixture.id) %}
                        <div class="d-flex flex-column gap-2">
                            {% for item in dist_map[fixture.id] %}
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="small text-secondary">
                                    <i class="bi bi-geo-alt me-1"></i>{{ item.warehouse_name }}
                                </span>
                                <span class="fw-bold small">{{ item.quantity }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-2">
                            <span class="extra-small text-muted text-uppercase fw-bold">Out of Stock</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="border-top pt-3 d-flex justify-content-between align-items-center">
                        <span class="text-muted extra-small text-uppercase fw-bold ls-1">Asset Class</span>
                        <div class="btn-group">
                            <a href="{{ url_for('view_fixture', id=fixture.id) }}"
                                class="btn btn-sm btn-outline-primary rounded-pill px-3 me-2">
                                <i class="bi bi-eye me-1"></i>View
                            </a>
                            <a href="{{ url_for('edit_fixture', id=fixture.id) }}"
                                class="btn btn-sm btn-outline-dark rounded-pill px-3">
                                Manage
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        {% if not fixtures %}
        <div class="col-12 text-center py-5">
            <div class="bg-light rounded-4 p-5 border border-dashed">
                <i class="bi bi-box-seam fs-1 text-muted opacity-25"></i>
                <h5 class="mt-3 text-muted">No fixtures registered yet</h5>
                <button class="btn btn-dark mt-3 rounded-pill" data-bs-toggle="modal"
                    data-bs-target="#addFixtureModal">Register First Item</button>
            </div>
        </div>
        {% endif %}
    </div>


</div>

<!-- Comprehensive Add Modal -->

<div class="modal fade" id="addFixtureModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-0">
                <h5 class="fw-bold">New Fixture Definition</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('add_fixture') }}" method="POST">
                <div class="modal-body p-4">
                    <!-- Section: Identity -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <label class="form-label small fw-bold">Display Name (Internal)</label>
                            <input type="text" name="name" class="form-control" placeholder="e.g. LED Profile 200"
                                required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Internal Model Name</label>
                            <input type="text" name="model_name" class="form-control" placeholder="LP-200-V2">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Factory Model Name</label>
                            <input type="text" name="factory_model_name" class="form-control" placeholder="F-XY-200">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">SKU / Part Number</label>
                            <input type="text" name="sku" class="form-control" placeholder="LUMI-001">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Category</label>
                            <select name="type_id" class="form-select" required>
                                <option value="">Select Type...</option>
                                {% for t in types %}
                                <option value="{{ t.id }}">{{ t.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Section: Technical Specs -->
                    <h6 class="text-uppercase small fw-bold text-primary mb-3">Technical Specifications</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label small fw-bold">Wattage</label>
                            <input type="number" name="power_watts" class="form-control" placeholder="200">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold">IP Rating</label>
                            <input type="text" name="ip_rating" class="form-control" placeholder="IP20">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold">Color</label>
                            <input type="text" name="color" class="form-control" placeholder="Black">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold">Beam Angle</label>
                            <input type="text" name="beam_angle" class="form-control" placeholder="15-30Â°">
                        </div>
                    </div>

                    <!-- Section: Commercials -->
                    <h6 class="text-uppercase small fw-bold text-success mb-3">Commercials & Supplier</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Supplier</label>
                            <select name="supplier_id" class="form-select">
                                <option value="">Select Supplier...</option>
                                {% for s in suppliers %}
                                <option value="{{ s.id }}">{{ s.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Cost (USD)</label>
                            <input type="number" step="0.01" name="cost" class="form-control" placeholder="0.00">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Price (SGD)</label>
                            <input type="number" step="0.01" name="price_sgd" class="form-control" placeholder="0.00">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Price (USD)</label>
                            <input type="number" step="0.01" name="price_usd" class="form-control" placeholder="0.00">
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">Remarks / Notes</label>
                            <textarea name="remarks" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary rounded-pill px-4">Save Fixture Profile</button>
                </div>
            </form>
        </div>
    </div>


</div>

<style>
    .ls-1 {
        letter-spacing: 0.05em;
    }

    .extra-small {
        font-size: 0.7rem;
    }

    .bg-opacity-10 {
        --bs-bg-opacity: 0.1;
    }

    .fixture-card {
        transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
    }

    .fixture-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, .1) !important;
    }

    .border-dashed {
        border-style: dashed !important;
    }

    .inventory-section {
        min-height: 80px;
    }
</style>

{% endblock %}